
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Function Wrapping &#8212; Ivy Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=7c465b21" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:100,200,300,regular,500,600,700,800,900" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=3ce10a4d"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=4ea706d9"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QP5BET66XH"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QP5BET66XH');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-QP5BET66XH');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'overview/deep_dive/function_wrapping';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://unify.ai/docs/versions/ivy.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="../../_static/js/kapa.ai.js?v=996880f3"></script>
    <link rel="icon" href="https://github.com/unifyai/unifyai.github.io/blob/main/img/externally_linked/ivy_logo_only.png?raw=true"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Formatting" href="formatting.html" />
    <link rel="prev" title="Inplace Updates" href="inplace_updates.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../index.html">
                        Home
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../get_started.html">
                        Get Started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demos/quickstart.html">
                        Quickstart
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demos/learn_the_basics.html">
                        Learn the basics
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demos/guides.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../demos/examples_and_demos.html">
                        Examples and Demos
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../motivation.html">
                        Motivation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../related_work.html">
                        Related Work
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../design.html">
                        Design
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../volunteer_ranks.html">
                        Contributor Leaderboard
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../deep_dive.html">
                        Deep Dive
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../glossary.html">
                        Glossary
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../faq.html">
                        FAQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../one_liners.html">
                        One liners
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/functional/ivy.functional.ivy.html">
                        Functions
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/data_classes/ivy.data_classes.html">
                        Data classes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/ivy.stateful.html">
                        Framework classes
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/ivy.utils.html">
                        Utils
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../docs/ivy_tests.test_ivy.helpers.html">
                        Testing
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../deep_dive.html" class="nav-link">Deep Dive</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Function Wrapping</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="function-wrapping">
<h1>Function Wrapping<a class="headerlink" href="#function-wrapping" title="Link to this heading">#</a></h1>
<p>When a backend framework is set by calling <code class="code docutils literal notranslate"><span class="pre">ivy.set_backend(backend_name)</span></code>, then all Ivy functions are <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/utils/backend/handler.py#L259">wrapped</a>.
This is achieved by calling <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L965">_wrap_function</a>, which will apply the appropriate wrapping to the given function, based on what decorators it has.
For example, <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/ivy/elementwise.py#L28">abs</a> has the decorators <code class="code docutils literal notranslate"><span class="pre">&#64;to_native_arrays_and_back</span></code> and <code class="code docutils literal notranslate"><span class="pre">&#64;handle_out_argument</span></code>, and so the backend implementations will also be wrapped with the <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L595">to_native_arrays_and_back</a> and <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L800">handle_out_argument</a> wrappers.</p>
<p>The new function returned by <code class="code docutils literal notranslate"><span class="pre">_wrap_function</span></code> is a replacement of the original function with extra code added to support requirements common to many functions in the API.
This is the main purpose of the wrapping, to avoid code duplication which would exist if we added identical logic in every single function independently.</p>
<p>Depending on the function being wrapped, the new function might handle <a class="reference internal" href="arrays.html"><span class="doc">Arrays</span></a>, <a class="reference internal" href="inplace_updates.html"><span class="doc">Inplace Updates</span></a>, <a class="reference internal" href="data_types.html"><span class="doc">Data Types</span></a> and/or <a class="reference internal" href="devices.html"><span class="doc">Devices</span></a>.</p>
<p>Our test decorators actually transforms to <code class="code docutils literal notranslate"><span class="pre">&#64;given</span></code> decorators at Pytest collecting time, therefore this allows us to use other <strong>Hypothesis</strong> decorators like, <code class="code docutils literal notranslate"><span class="pre">&#64;reproduce_failure</span></code>, <code class="code docutils literal notranslate"><span class="pre">&#64;settings</span></code>, <code class="code docutils literal notranslate"><span class="pre">&#64;seed</span></code>.</p>
<section id="decorator-order">
<h2>Decorator order<a class="headerlink" href="#decorator-order" title="Link to this heading">#</a></h2>
<p>The order in which Ivy decorators are applied is important. It is important to follow this order, as the functionality of many functions depends on it. If the decorators are applied in the wrong order, the test may fail or the function may not behave as expected.
The following is the recommended order to follow :</p>
<ol class="arabic simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_complex_input</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;infer_device</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_device_shifting</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;infer_dtype</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_array_function</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;outputs_to_ivy_arrays</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;outputs_to_ivy_shapes</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;outputs_to_native_arrays</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;inputs_to_native_arrays</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;inputs_to_native_shapes</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;inputs_to_ivy_arrays</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_out_argument</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_view_indexing</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_view</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_array_like_without_promotion</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_partial_mixed_function</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_nestable</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_ragged</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_backend_invalid</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_exceptions</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&#64;handle_nans</span></code></p></li>
</ol>
<p>This recommended order is followed to ensure that tests are efficient and accurate. It is important to follow this order because the decorators depend on each other. For example, the <code class="code docutils literal notranslate"><span class="pre">&#64;infer_device</span></code> decorator needs to be applied before the <code class="code docutils literal notranslate"><span class="pre">&#64;infer_dtype</span></code> decorator, because the <code class="code docutils literal notranslate"><span class="pre">&#64;infer_dtype</span></code> decorator needs to know the device of the function in order to infer the data type.</p>
</section>
<section id="conversion-wrappers">
<h2>Conversion Wrappers<a class="headerlink" href="#conversion-wrappers" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L405">inputs_to_native_arrays</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> instances in the arguments to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeArray</span></code> counterparts, based on the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a> before calling the function.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L445">inputs_to_ivy_arrays</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeArray</span></code> instances in the arguments to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> counterparts, based on the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a> before calling the function.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L525">outputs_to_ivy_arrays</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeArray</span></code> instances in the outputs to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> counterparts, based on the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a> before calling the function.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L595">to_native_arrays_and_back</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> instances in the arguments to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeArray</span></code> counterparts, calls the function with those arguments and then converts the <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeArray</span></code> instances in the output back to <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code>.
This wrapping function is heavily used because it enables achieving the objective of ensuring that every ivy function could accept an <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> and return an <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code>, making it independent of the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a>.</p></li>
</ol>
</section>
<section id="inference-wrappers">
<h2>Inference Wrappers<a class="headerlink" href="#inference-wrappers" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L725">infer_dtype</a> : This wrapping function infers the <cite>dtype</cite> argument to be passed to a function based on the array arguments passed to it.
If <code class="code docutils literal notranslate"><span class="pre">dtype</span></code> is explicitly passed to the function, then it is used directly.
This wrapping function could be found in functions from the <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/ivy/creation.py">creation submodule</a> such as <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/ivy/creation.py#L482">zeros</a> where we then allow the user to not enter the <code class="code docutils literal notranslate"><span class="pre">dtype</span></code> argument to such functions.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L763">infer_device</a> : Similar to the <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L725">infer_dtype</a> wrapping function, the <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L763">infer_device</a> function wrapping infers the <code class="code docutils literal notranslate"><span class="pre">device</span></code> argument to be passed to a function based on the first array argument passed to it.
This wrapping function is also used a lot in functions from the <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/ivy/creation.py">creation submodule</a> such as <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/ivy/creation.py#L383">asarray</a>, where we want to create the <cite>ivy.Array</cite> on the same device as the input array.</p></li>
</ol>
</section>
<section id="out-argument-support">
<h2>Out Argument Support<a class="headerlink" href="#out-argument-support" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L800">handle_out_argument</a> : This wrapping function is used in nearly all ivy functions.
It enables appropriate handling of the <code class="code docutils literal notranslate"><span class="pre">out</span></code> argument of functions.
In cases where the backend framework natively supports the <code class="code docutils literal notranslate"><span class="pre">out</span></code> argument for a function, we prefer to use it as it’s a more efficient implementation of the <code class="code docutils literal notranslate"><span class="pre">out</span></code> argument for that particular backend framework.
But in cases when it isn’t supported, we support it anyway with <a class="reference internal" href="inplace_updates.html"><span class="doc">Inplace Updates</span></a>.</p></li>
</ol>
</section>
<section id="nestable-support">
<h2>Nestable Support<a class="headerlink" href="#nestable-support" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L896">handle_nestable</a> : This wrapping function enables the use of <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Container</span></code> arguments in functions and directly calling them through the <code class="code docutils literal notranslate"><span class="pre">ivy</span></code> namespace, just like calling a function with <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Array</span></code> arguments instead. Thus, the function can be called by passing an <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Container</span></code> to any or all of its arguments.</p></li>
</ol>
</section>
<section id="partial-mixed-function-support">
<h2>Partial Mixed Function Support<a class="headerlink" href="#partial-mixed-function-support" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L944">handle_partial_mixed_function</a>: This wrapping function enables switching between compositional and primary implementations of <a class="reference internal" href="function_types.html#mixed-functions"><span class="std std-ref">Mixed Functions</span></a> based on some condition on the arguments of the function.</p></li>
<li><p>The condition is specified through a lambda function which when evaluates to <cite>True</cite> the primary implementation is run and otherwise the compositional implementation is executed.</p></li>
<li><p>For backends that have a primary implementation of a mixed function, the reference to the compositional implementation is <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L1054">stored as an attribute</a> inside the backend function during backend setting. To make use of this decorator, one must</p></li>
<li><p>add the <code class="code docutils literal notranslate"><span class="pre">partial_mixed_handler</span></code> attribute containing the lambda function to the backend implementation. Here’s an <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/functional/backends/torch/layers.py#L30">example</a> from the torch backend implementation of linear.</p></li>
</ol>
</section>
<section id="shape-conversion">
<h2>Shape Conversion<a class="headerlink" href="#shape-conversion" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L488">inputs_to_native_shapes</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Shape</span></code> instances in the arguments to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeShape</span></code> counterparts, based on the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a> before calling the function.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L501">outputs_to_ivy_shapes</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeShape</span></code> instances in the outputs to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Shape</span></code> counterparts, based on the <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a> before calling the function.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L514">to_native_shapes_and_back</a> : This wrapping function converts all <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Shape</span></code> instances in the arguments to their <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeShape</span></code> counterparts, calls the function with those arguments and then converts the <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.NativeShape</span></code> instances in the output back to <code class="xref py py-class docutils literal notranslate"><span class="pre">ivy.Shape</span></code>.</p></li>
</ol>
</section>
<section id="view-handling">
<h2>View Handling<a class="headerlink" href="#view-handling" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L627">handle_view</a> : This wrapping function performs view handling based on our <a class="reference internal" href="inplace_updates.html#views"><span class="std std-ref">Views</span></a> policy.</p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L659">handle_view_indexing</a> : This wrapping function is aimed at handling views for indexing.</p></li>
</ol>
</section>
<section id="exception-handling">
<h2>Exception Handling<a class="headerlink" href="#exception-handling" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/utils/exceptions.py#L189">handle_exceptions</a> : This wrapping function helps in catching native exceptions and unifying them into <cite>IvyException</cite> or the relevant subclasses. More information can be found in the <a class="reference internal" href="#exception-handling"><span class="std std-ref">Exception Handling</span></a> section.</p></li>
</ol>
</section>
<section id="miscellaneous-wrappers">
<h2>Miscellaneous Wrappers<a class="headerlink" href="#miscellaneous-wrappers" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L299">handle_array_function</a> : This wrapping function enables <a class="reference internal" href="arrays.html#integrating-custom-classes-with-ivy"><span class="std std-ref">Integrating custom classes with Ivy</span></a></p></li>
<li><p><a class="reference external" href="https://github.com/unifyai/ivy/blob/bd9b5b1080d33004e821a48c486b3a879b9d6616/ivy/func_wrapper.py#L1393">handle_complex_input</a> : This wrapping function enables handling of complex numbers. It introduces a keyword argument <code class="code docutils literal notranslate"><span class="pre">complex_mode</span></code>, which is used to choose the function’s behaviour as per the wrapper’s docstring.</p></li>
</ol>
<p>When calling <a class="reference external" href="https://github.com/unifyai/ivy/blob/5658401b266352d3bf72c95e4af6ae9233115722/ivy/func_wrapper.py#L965">_wrap_function</a> during <a class="reference internal" href="backend_setting.html"><span class="doc">Backend Setting</span></a>, firstly the attributes of the functions are checked to get all the wrapping functions for a particular function.
Then all the wrapping functions applicable to a function are used to wrap the function.</p>
<p>Each of these topics and each associated piece of logic added by the various wrapper functions are covered in more detail in the next sections.
For now, suffice it to say that they do quite a lot.</p>
<p><strong>Round Up</strong></p>
<p>This should have hopefully given you a good feel for how function wrapping is applied to functions in Ivy.</p>
<p>If you have any questions, please feel free to reach out on <a class="reference external" href="https://discord.gg/sXyFF8tDtm">discord</a> in the <a class="reference external" href="https://discord.com/channels/799879767196958751/1189906704775794688">function wrapping thread</a>!</p>
<p><strong>Video</strong></p>
<iframe width="420" height="315" allow="fullscreen;"
src="https://www.youtube.com/embed/-RGXxrP849k" class="video">
</iframe></section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="inplace_updates.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Inplace Updates</p>
      </div>
    </a>
    <a class="right-next"
       href="formatting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Formatting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decorator-order">Decorator order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-wrappers">Conversion Wrappers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-wrappers">Inference Wrappers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-argument-support">Out Argument Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nestable-support">Nestable Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-mixed-function-support">Partial Mixed Function Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shape-conversion">Shape Conversion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#view-handling">View Handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exception-handling">Exception Handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-wrappers">Miscellaneous Wrappers</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Transpile AI.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>